<!-- HEADER -->
<header class="app-header app-header--scrolled">
  <div class="header__inner container">
    <a routerLink="/" class="header__logo-link">
      <svg class="header__logo-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 1.5c-3.03 0-5.5 2.47-5.5 5.5v3h-3a1 1 0 00-1 1v3a1 1 0 001 1h18a1 1 0 001-1v-3a1 1 0 00-1-1h-3v-3c0-3.03-2.47-5.5-5.5-5.5zM12 4.5c1.93 0 3.5 1.57 3.5 3.5v3H8.5v-3c0-1.93 1.57-3.5 3.5-3.5z" /></svg>
      <span class="header__logo-text">ChefKit</span>
    </a>
    <div class="header__actions">
      <ng-container *ngIf="!authService.isLoggedIn()">
        <a routerLink="/login" class="button button--secondary header__nav-link--alt">Se connecter</a>
        <a routerLink="/register" class="button button--primary">S'inscrire</a>
      </ng-container>
      <ng-container *ngIf="authService.isLoggedIn()">
        <span class="header__welcome-message">
          <ng-container *ngIf="authService.currentUser()?.role === 'admin'; else userWelcome">
            Bonjour admin {{ authService.currentUser()?.nomUtilisateur }}
          </ng-container>
          <ng-template #userWelcome>
            Bonjour {{ authService.currentUser()?.nomUtilisateur }}
          </ng-template>
        </span>
        <button (click)="logout()" class="button button--secondary header__nav-link--alt">Se déconnecter</button>
      </ng-container>
    </div>
  </div>
</header>

<!-- SECTION CONTENU RECETTE -->
<main class="recipe-page">
  <div *ngIf="isLoading" class="loading-indicator">
    <p>Chargement de la recette...</p>
  </div>

  <div *ngIf="!isLoading && !recette" class="error-indicator">
    <p>Oups ! Cette recette est introuvable.</p>
    <a routerLink="/" class="button button--primary">Retour à l'accueil</a>
  </div>

  <ng-container *ngIf="!isLoading && recette">
    <div class="recipe-content-container container">
      <!-- Colonne de gauche : Image et Méta-infos -->
      <aside class="recipe-aside">
        <div class="recipe-image-container">
          <img [src]="recette.pathImage" [alt]="recette.titre" class="recipe-image">
        </div>
        <div class="recipe-meta">
          <div class="meta-item">
            <svg class="meta-item__icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v5h-2zm0 6h2v2h-2z"/></svg>
            <span class="meta-item__label">Préparation</span>
            <span class="meta-item__value">{{ recette.tempsPreparationMinutes }} min</span>
          </div>
          <div class="meta-item">
            <svg class="meta-item__icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v5h-2zm0 6h2v2h-2z"/></svg>
            <span class="meta-item__label">Cuisson</span>
            <span class="meta-item__value">{{ recette.tempsCuissonMinutes }} min</span>
          </div>
          <div class="meta-item">
            <svg class="meta-item__icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v5h-2zm0 6h2v2h-2z"/></svg>
            <span class="meta-item__label">Portions</span>
            <span class="meta-item__value">{{ recette.nombrePersonnes }} personnes</span>
          </div>
        </div>
      </aside>

      <!-- Colonne de droite : Titre, Description, Ingrédients, Instructions -->
      <div class="recipe-main-content">
        <button (click)="goBack()" class="button button--secondary button--back">
          <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          Retour
        </button>

        <div class="recipe-header">
          <h1 class="recipe-title">{{ recette.titre }}</h1>
          <p class="recipe-description">{{ recette.description }}</p>
        </div>

        <div class="recipe-ingredients">
          <h2 class="section-subtitle">Ingrédients</h2>
          
          <!-- If user is logged in, show owned/missing lists -->
          <ng-container *ngIf="isUserLoggedIn">
            <h3 class="subsection-title">Ce que vous avez :</h3>
            <ul class="ingredients-list ingredients-list--owned">
              <li *ngFor="let ing of ownedIngredients" class="ingredient-item">
                <span class="ingredient-name">{{ ing.name }}</span>
                <span class="ingredient-quantity">{{ ing.quantity }} {{ ing.unit }}</span>
              </li>
              <li *ngIf="ownedIngredients.length === 0" class="ingredient-item--empty">Vous n'avez aucun de ces ingrédients.</li>
            </ul>

            <h3 class="subsection-title">Ce qu'il vous manque :</h3>
            <ul class="ingredients-list ingredients-list--missing">
              <li *ngFor="let ing of missingIngredients" class="ingredient-item">
                <span class="ingredient-name">{{ ing.name }}</span>
                <span class="ingredient-quantity">{{ ing.quantity }} {{ ing.unit }}</span>
              </li>
              <li *ngIf="missingIngredients.length === 0" class="ingredient-item--empty">Vous avez tous les ingrédients !</li>
            </ul>
          </ng-container>

          <!-- If user is not logged in, show the original full list -->
          <ng-container *ngIf="!isUserLoggedIn">
            <ul class="ingredients-list">
              <li *ngFor="let ing of ingredients" class="ingredient-item">
                <span class="ingredient-name">{{ ing.name }}</span>
                <span class="ingredient-quantity">{{ ing.quantity }} {{ ing.unit }}</span>
              </li>
            </ul>
          </ng-container>
        </div>

        <div class="recipe-instructions">
          <h2 class="section-subtitle">Préparation</h2>
          <ol class="instructions-list">
            <li *ngFor="let step of instructionSteps; let i = index" class="instruction-step">
              <span class="step-number">{{ i + 1 }}</span>
              <p class="step-text">{{ step }}</p>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </ng-container>
</main>

<!-- FOOTER -->
<footer class="app-footer">
  <div class="footer__inner container">
    <div class="footer__brand">
      <span class="footer__logo-text">ChefKit</span>
      <p class="footer__slogan">Simplifiez votre quotidien.</p>
    </div>
    <nav class="footer__nav">
      <a routerLink="/terms" class="footer__nav-link">Conditions d'utilisation</a>
      <a routerLink="/privacy" class="footer__nav-link">Politique de confidentialité</a>
    </nav>
    <div class="footer__copyright">
      &copy; {{ currentYear }} ChefKit. Tous droits réservés.
    </div>
  </div>
</footer>