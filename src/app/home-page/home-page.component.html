<!-- HEADER : Minimaliste avec logo et boutons de connexion -->
<header class="app-header" [class.app-header--scrolled]="isScrolled">
  <div class="header__inner container">
    <a routerLink="/" class="header__logo-link">
      <svg class="header__logo-icon" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 1.5c-3.03 0-5.5 2.47-5.5 5.5v3h-3a1 1 0 00-1 1v3a1 1 0 001 1h18a1 1 0 001-1v-3a1 1 0 00-1-1h-3v-3c0-3.03-2.47-5.5-5.5-5.5zM12 4.5c1.93 0 3.5 1.57 3.5 3.5v3H8.5v-3c0-1.93 1.57-3.5 3.5-3.5z" />
      </svg>
      <span class="header__logo-text">ChefKit</span>
    </a>
    <div class="header__actions">
      <!-- Si l'utilisateur n'est pas connecté -->
      <ng-container *ngIf="!authService.isLoggedIn()">
        <a routerLink="/login" class="button button--secondary header__nav-link--alt">Se connecter</a>
        <a routerLink="/register" class="button button--primary">S'inscrire</a>
      </ng-container>

      <ng-container *ngIf="authService.isLoggedIn()">
        <a routerLink="/ingredient" class="button button--secondary">Mes ingrédients</a>
        <a *ngIf="authService.currentUser()?.role === 'admin'" routerLink="/admin"
          class="button button--secondary">Admin</a>

        <span class="header__welcome-message">
          <ng-container *ngIf="authService.currentUser()?.role === 'admin'; else userWelcome">
            Bonjour admin {{ authService.currentUser()?.nomUtilisateur }}
          </ng-container>
          <ng-template #userWelcome>
            Bonjour {{ authService.currentUser()?.nomUtilisateur }}
          </ng-template>
        </span>
        <button (click)="logout()" class="button button--primary header__nav-link--alt">
          Se déconnecter
        </button>
      </ng-container>
    </div>
  </div>
</header>

<!-- SECTION HERO -->
<section class="hero section-padding">
  <div class="hero__content container text-center">
    <h1 class="hero__title">
      Votre ingrédient. <br />
      Notre inspiration.
    </h1>
    <p class="hero__subtitle">
      Dites-nous ce que vous avez, et ChefKit fera le reste. Trouvez des recettes qui vous ressemblent.
    </p>

    <div class="hero__integrated-search-container">
      <div class="hero__search-main-row">
        <input type="text" placeholder="Ajouter des ingrédients (ex: poulet, riz, brocoli)" class="hero__search-input"
          aria-label="Recherche de recettes par ingrédients" />
        <button class="button button--primary hero__search-button">
          Rechercher <span class="visually-hidden">une recette</span>
        </button>
      </div>

      <div class="hero__filter-options">
        <span class="hero__filter-label visually-hidden">Filtres rapides :</span>
        <button class="filter-chip" [class.active]="selectedFilters.vegetarian" (click)="toggleFilter('vegetarian')">
          Végétarien
        </button>
        <button class="filter-chip" [class.active]="selectedFilters.vegan" (click)="toggleFilter('vegan')">
          Vegan
        </button>
        <button class="filter-chip" [class.active]="selectedFilters.glutenFree" (click)="toggleFilter('glutenFree')">
          Sans Gluten
        </button>
      </div>
    </div>
  </div>
</section>

<!-- SECTION RECETTES MISES EN AVANT - CARROUSEL -->
<section class="featured-recipes section-padding">
  <h2 class="section-title">Nos Dernières Idées Recettes</h2>

  <!-- États de chargement -->
  <div *ngIf="isLoading && featuredRecipes.length === 0" class="text-center">Chargement des recettes...</div>
  <div *ngIf="errorMsg" class="text-center text-red-500">{{ errorMsg }}</div>

  <div class="carousel-container container" *ngIf="!isLoading && featuredRecipes.length > 0">
    <!-- Flèche gauche -->
    <button class="carousel-arrow carousel-arrow--left" (click)="prevSlide()" aria-label="Recette précédente">
      <svg class="carousel-arrow-icon" fill="currentColor" viewBox="0 0 24 24">
        <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z" />
      </svg>
    </button>

    <div class="carousel-wrapper">
      <div class="carousel-track" [style.transform]="'translateX(-' + (currentSlideIndex * 100) + '%)'">
        <ng-container *ngFor="let i of Array(totalSlides).keys()">
          <div class="carousel-slide">
            <a *ngFor="let recette of featuredRecipes.slice(i * recipesPerSlide, (i + 1) * recipesPerSlide)"
              (click)="ouvrirRecette(recette.idRecette)" class="recipe-card carousel-item">
              <div class="recipe-card__image-container">
                <img *ngIf="recette.pathImage" [src]="recette.pathImage" [alt]="recette.titre"
                  class="recipe-card__image" />
              </div>
              <div class="recipe-card__content">
                <h3 class="recipe-card__title">{{ recette.titre }}</h3>
                <span class="recipe-card__cta">Voir la recette</span>
              </div>
            </a>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Flèche droite -->
    <button class="carousel-arrow carousel-arrow--right" (click)="nextSlide()" aria-label="Recette suivante">
      <svg class="carousel-arrow-icon" fill="currentColor" viewBox="0 0 24 24">
        <path d="M8.59 16.59L13.17 12l-4.58-4.59L10 6l6 6-6 6z" />
      </svg>
    </button>
  </div>
</section>

<!-- NOUVELLE SECTION : RECETTES SUGGÉRÉES -->
<section *ngIf="authService.isLoggedIn()" class="associated-recipes section-padding bg-light">
  <h2 class="section-title">Recettes suggérées pour vous</h2>

  <!-- Cas 1: Chargement en cours -->
  <div *ngIf="isLoadingAssociated" class="text-center">Chargement des suggestions...</div>

  <!-- Cas 2: Chargement terminé -->
  <ng-container *ngIf="!isLoadingAssociated">
    <!-- Sous-cas A: Des recettes ont été trouvées -->
    <div class="recipes-grid container" *ngIf="associatedRecipes.length > 0">
      <a *ngFor="let recette of associatedRecipes" (click)="ouvrirRecette(recette.idRecette)" class="recipe-card">
        <div class="recipe-card__image-container">
          <img *ngIf="recette.pathImage" [src]="recette.pathImage" [alt]="recette.titre" class="recipe-card__image" />
        </div>
        <div class="recipe-card__content">
          <h3 class="recipe-card__title">{{ recette.titre }}</h3>
          <span class="recipe-card__cta">Voir la recette</span>
        </div>
      </a>
    </div>
    <!-- Sous-cas B: Aucune recette n'a été trouvée -->
    <div *ngIf="associatedRecipes.length === 0" class="container text-center">
      <p>Aucune recette ne correspond aux ingrédients de votre frigo. <a routerLink="/ingredient">Ajoutez-en d'autres
          !</a></p>
    </div>
  </ng-container>
</section>


<!-- NOUVELLE SECTION : TOUTES LES RECETTES -->
<section class="all-recipes section-padding">
  <h2 class="section-title">Toutes Nos Recettes</h2>

  <div *ngIf="isLoading" class="text-center">Chargement de toutes les recettes...</div>
  <div *ngIf="errorMsg" class="text-center text-red-500">{{ errorMsg }}</div>

  <div class="recipes-grid container" *ngIf="!isLoading && recettes.length > 0">
    <a *ngFor="let recette of recettes" (click)="ouvrirRecette(recette.idRecette)" class="recipe-card">
      <div class="recipe-card__image-container">
        <img *ngIf="recette.pathImage" [src]="recette.pathImage" [alt]="recette.titre" class="recipe-card__image" />
      </div>
      <div class="recipe-card__content">
        <h3 class="recipe-card__title">{{ recette.titre }}</h3>
        <span class="recipe-card__cta">Voir la recette</span>
      </div>
    </a>
  </div>

  <div *ngIf="!isLoading && recettes.length === 0 && !errorMsg" class="text-center">
    Aucune recette trouvée pour le moment.
  </div>
</section>

<!-- FOOTER -->
<footer class="app-footer">
  <div class="footer__inner container">
    <div class="footer__brand">
      <span class="footer__logo-text">ChefKit</span>
      <p class="footer__slogan">Simplifiez votre quotidien.</p>
    </div>
    <nav class="footer__nav">
      <a routerLink="/terms" class="footer__nav-link">Conditions d'utilisation</a>
      <a routerLink="/privacy" class="footer__nav-link">Politique de confidentialité</a>
    </nav>
    <div class="footer__copyright">
      &copy; {{ currentYear }} ChefKit. Tous droits réservés.
    </div>
  </div>
</footer>